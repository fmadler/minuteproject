<!DOCTYPE root>
<generator-config xmlns="http://minuteproject.sf.net/xsd/mp-config"
	xmlns:xs="http://www.w3.org/2001/XMLSchema-instance"
	xs:noNamespaceSchemaLocation="mp-config.xsd">
	<configuration>
		<conventions>
			<!-- <target-convention type="enable-updatable-code-feature" /> -->
			<target-convention type="disable-timestamp-comment-marker" />
		</conventions>
		<context class="com.winy.context.ThreadContext" init="ThreadContext.get()">
			<context-parameters>
				<context-parameter name="userId" type="int"></context-parameter>
			</context-parameters>
		</context>
<!--		<model name="winy" version="0.9.3" package-root="com">-->
		<model name="entityvaluestore" version="0.9.3" package-root="org.minuteproject.ms">
			<description>
				<CDATA>
					This model illustrates:
					Reverse-engineering on tables, views
					SDD
					Add ad-hoc forms and actions
				</CDATA>
			</description>
			<data-model database-type="MYSQL">
				<driver name="mysql" version="5.1.16" groupId="mysql"
						artifactId="mysql-connector-java"></driver>
				<!-- <driver name="mysql" version="8.0.19" groupId="mysql"
					artifactId="mysql-connector-java"></driver> -->
				<dataSource>
				<!--  old : org.gjt.mm.mysql.Driver 
					  new : com.mysql.cj.jdbc.Driver

					<driverClassName>com.mysql.cj.jdbc.Driver</driverClassName>
					-->
					<driverClassName>org.gjt.mm.mysql.Driver</driverClassName>
					<url>${jdbcUrl}</url>
					<username>${username}</username>
					<password>${password}</password>
				</dataSource>
				<!-- for Oracle and DB2 please set the schema <schema> </schema> -->
				<primaryKeyPolicy oneGlobal="true">
					<primaryKeyPolicyPattern name="identityPattern"></primaryKeyPolicyPattern>
				</primaryKeyPolicy>
			</data-model>
			<business-model>
				<generation-condition>
					<condition type="exclude" startsWith="flyway" />
					<condition type="exclude" startsWith="v_apply_ppc" />
					<condition type="exclude" startsWith="v_invoice" />
					<condition type="exclude" startsWith="v_all_possible_ppc" />
					<condition type="exclude" startsWith="private" />
					<condition type="exclude" startsWith="v_private" />
					<condition type="exclude" startsWith="v_security" />
					<condition type="exclude" startsWith="post_" />
					<condition type="exclude" startsWith="v_winery_public_detail" />
				</generation-condition>
				<business-package default="project">
					<condition type="package" startsWith="STAT" result="statistics"></condition>
					<condition type="package" startsWith="SEC" result="security"></condition>
					<condition type="package" startsWith="ADMIN" result="admin"></condition>
					<condition type="package" startsWith="RELEASE" result="release"></condition>
					<condition type="package" startsWith="VIEW_STAT" result="stats"></condition>
					<condition type="package" startsWith="JOB_" result="job"></condition>
					<condition type="package" startsWith="UTIL_" result="util"></condition>
					<condition type="package" startsWith="I18N_" result="i18n"></condition>
					<condition type="package" startsWith="CONF" result="config"></condition>
					<condition type="package" startsWith="TEMPLATE_" result="template"></condition>
					<condition type="package" startsWith="INVOICE_" result="invoice"></condition>
				</business-package>
				<enrichment>
					<entity name="USER_ACCOUNT">
						<field name="REGISTRATION_TYPE">
							<property tag="checkconstraint">
								<property name="INVITATION_REQUEST" />
								<property name="INVITED" />
								<property name="SELF_REGISTERED" />
								<property name="INITIALISATION" />
							</property>
						</field>
						<field name="STATUS">
							<property tag="checkconstraint">
								<property name="ACTIVE" />
								<property name="BLOCKED" />
								<property name="INVITATION_REQUEST" />
								<property name="AWAITING_CONFIRMATION" />
								<property name="INVITATION_REQUEST_REJECTED" />
								<property name="INACTIVE" />
							</property>
						</field>
					</entity>

					<entity name="USER">
						<field name="STATUS">
							<property tag="checkconstraint">
								<property name="ACTIVE" />
								<property name="INACTIVE" />
							</property>
						</field>
					</entity>
					<conventions>
						<default-value-convention 
							field-pattern="ACTIVE" 
							field-pattern-type="equals"
							field-type="boolean"
							default-value="true"/>
							
						<default-value-convention 
							field-pattern="ZOOM" 
							field-pattern-type="ends-with"
							field-type="integer"
							default-value="8"/>
							
						<default-value-convention 
							field-pattern="LANGUAGE_CODE" 
							field-pattern-type="ends-with"
							field-type="string"
							default-value="EN"/>
							
						<default-value-convention 
							field-pattern="DISPLAY_ORDER" 
							field-pattern-type="equals"
							field-type="integer"
							default-value="1"/>

						<check-constraint-convention
							field-pattern="DURATION_UNIT" field-pattern-type="endsWith">
							<property name="YEAR" />
							<property name="MONTH" />
							<property name="WEEK" />
						</check-constraint-convention>

						<check-constraint-convention
							field-pattern="GENDER" field-pattern-type="endsWith">
							<property name="MALE" />
							<property name="FEMALE" />
							<property name="NONE" />
						</check-constraint-convention>

						<entity-content-type-convention
							type="apply-content-type-to-entity-starting-with" pattern="I18N_"
							content-type="reference-data" />
						<entity-content-type-convention
							type="apply-content-type-to-entity-starting-with" pattern="REF_"
							content-type="reference-data" />
						<entity-content-type-convention
							type="apply-content-type-to-entity-containing" pattern="PAY_PLAN"
							content-type="reference-data" />

						<column-naming-convention type="apply-strip-column-name-suffix"
							pattern-to-strip="_ID" />
						<reference-naming-convention
							type="apply-referenced-alias-when-no-ambiguity" is-to-plurialize="true" />
						<reference-naming-convention type="apply-many-to-many-aliasing"
							is-to-plurialize="true" />

						<ordering-convention field-pattern="DISPLAY_ORDER"
							field-pattern-type="endsWith" ordering="asc" />
						<ordering-convention field-pattern="SEQUENCE_ORDER"
							field-pattern-type="endsWith" ordering="asc" />
						<ordering-convention field-pattern="RANKING"
							field-pattern-type="endsWith" ordering="asc" />

						<!-- stereotype email, URL -->
						<stereotype-convention field-pattern="mail"
							field-pattern-type="endsWith" stereotype="email" />
						<stereotype-convention field-pattern="_fee" field-pattern-type="endsWith" stereotype="money"/>
						<stereotype-convention field-pattern="price" field-pattern-type="endsWith" stereotype="money"/>
						<stereotype-convention field-pattern="price" field-pattern-type="startsWith" stereotype="money" />
						<stereotype-convention field-pattern="timestamp" field-pattern-type="contains" stereotype="datetime" />
						<stereotype-convention field-pattern="_datetime" field-pattern-type="contains" stereotype="datetime" />
						<stereotype-convention field-pattern="CREATION_DATE" field-pattern-type="equals" stereotype="datetime" />
						<stereotype-convention field-pattern="LAST_MODIFICATION" field-pattern-type="equals" stereotype="datetime" />
						<stereotype-convention field-pattern="_LAST_MOD" field-pattern-type="endsWith" stereotype="datetime" />
						<stereotype-convention field-pattern="url" field-pattern-type="end-with" stereotype="url" />
						<stereotype-convention field-pattern="web_site" field-pattern-type="end-with" stereotype="url" />
						<stereotype-convention field-pattern="website" field-pattern-type="end-with" stereotype="url" />
						<stereotype-convention field-pattern="password"
							field-pattern-type="contains" stereotype="password" />
						<stereotype-convention field-pattern="notes"
							field-pattern-type="equals" stereotype="text-html" />

						<!-- primary key conv -->
						<column-naming-convention
							type="apply-fix-primary-key-column-name-when-no-ambiguity-and-not-natural"
							default-value="ID" />

						<!-- strip prefix -->
						<entity-naming-convention type="apply-strip-table-name-prefix"
							pattern-to-strip="ADMIN_,SEC_,BUS_" />

						<!-- trigger -->
						<property-convention scope="field" pattern="WEB_PATH" tag="trigger-custom" type="start-with" />
						<property-convention scope="field" pattern="CREATION_DATE" tag="trigger-insert-with-current-date" type="start-with" />
						<property-convention scope="field" pattern="LAST_MODIFICATION" tag="trigger-update-with-current-date" type="equals" />
						<property-convention scope="field" pattern="_LAST_MOD" tag="trigger-update-with-current-date" type="end-with" /><!-- change to ends-with -->
						<property-convention scope="field" pattern="GRAPH_LAST_MOD" tag="trigger-custom" type="ends-With" />
						<view-primary-key-convention
							type="apply-default-primary-key-otherwise-first-one"
							default-primary-key-names="IDENTIFIER,ID" />

						<!-- content type -->
						<entity-content-type-convention
							type="apply-content-type-to-entity-belonging-to-package" pattern="reference"
							content-type="reference-data" />

						<semantic-reference-convention
							content-type="reference-data" field-pattern="NAME"
							field-pattern-type="endsWith" max-number-of-fields="5" />
							
						<semantic-reference-convention
							content-type="pseudo-static-data" field-pattern="NAME"
						    field-pattern-type="endsWith" max-number-of-fields="5" /> 
						    
						<!-- TODO only apply one similar convention last prevails -->
												    
						<field-validation-convention 
							field-pattern="_YEAR" 
							field-pattern-type="endsWith" 
							field-type="integer">
							<validation-range min="1900" max="2050"/>
						</field-validation-convention>
						
						<field-validation-convention 
							field-pattern="NB_OF_YEAR" 
							field-pattern-type="endsWith" 
							field-type="integer">
							<validation-range min="0" max="100"/>
						</field-validation-convention>
						<field-validation-convention field-pattern="NB_OF_YEARS" field-pattern-type="endsWith" field-type="integer">
							<validation-range min="0" max="100"/>
						</field-validation-convention>

						<field-validation-convention field-pattern="_HOUR" field-pattern-type="endsWith" field-type="integer">
							<validation-range min="0" max="23"/>
						</field-validation-convention>
						<field-validation-convention field-pattern="_MINUTE" field-pattern-type="endsWith" field-type="integer">
							<validation-range min="0" max="59"/>
						</field-validation-convention>
						<field-validation-convention field-pattern="GOOGLE_ZOOM" field-pattern-type="endsWith" field-type="integer">
							<validation-range min="1" max="30"/>
						</field-validation-convention>

						<entity-display-convention
							type="field-group" 
							first-field-pattern="START_HOUR"
							second-field-pattern="START_MINUTE"
							field-pattern-type="ends-with"
						/>
						<entity-display-convention
							type="field-group" 
							first-field-pattern="END_HOUR"
							second-field-pattern="END_MINUTE"
							field-pattern-type="ends-with"
						/>
						<entity-display-convention
							type="field-group" 
							first-field-pattern="_MIN"
							second-field-pattern="_MAX"
							third-field-pattern="_AVG"
							field-pattern-type="ends-with"
						/>
						<entity-display-convention
							type="field-group" 
							first-field-pattern="_FROM"
							second-field-pattern="_UNTIL"
							field-pattern-type="ends-with"
						/>
						<entity-display-convention
							type="field-group" 
							first-field-pattern="_FROM"
							second-field-pattern="_TO"
							field-pattern-type="ends-with"
						/>
						<entity-display-convention
							type="field-group" 
							first-field-pattern="FROM_"
							second-field-pattern="TO_"
							field-pattern-type="starts-with"
						/>
						<entity-display-convention
							type="field-group" 
							first-field-pattern="_LONGITUDE"
							second-field-pattern="_LATITUDE"
							third-field-pattern="_GOOGLE_ZOOM"
							field-pattern-type="ends-with"
						/>
						<entity-display-convention
							type="field-group" 
							first-field-pattern="LONGITUDE"
							second-field-pattern="LATITUDE"
							third-field-pattern="ZOOM"
							field-pattern-type="equals"
						/>
						<entity-display-convention
							type="field-group" 
							first-field-pattern="LONGITUDE_"
							second-field-pattern="LATITUDE_"
							third-field-pattern="GOOGLE_ZOOM"
							field-pattern-type="starts-with"
						/>
						<entity-display-convention
							type="field-group" 
							first-field-pattern="LONGITUDE"
							second-field-pattern="LATITUDE"
							field-pattern-type="equals"
						/>
						<entity-validation-convention type="first-field-less-than-second-field" 
							first-field-pattern="_MIN"
							second-field-pattern="_MAX"
							field-pattern-type="ends-with"
						/>
					</conventions>
				</enrichment>
			</business-model>
			<statement-model>
				<queries>
					<query name="image_entity_value" id="image_entity_value"
						package-name="image">
						<query-body>
							<value>
<![CDATA[
select * from picture_entity_value iev where 1=1 
$where_entity $where_id_entity $where_web_path_entity $whereid
]]>
								<!-- $whereentity $whereentityid $whereentitywebpath bug => select 
									* from picture_entity_value iev where 1=1 AND entity = 'region' AND entity 
									= 99id AND entity = 'xxx'webpath AND entity_id = ? AND entity_web_path = 
									? MP error for generation replace all $whereentity but $whereentityid starts 
									with $whereentity -->
							</value>
						</query-body>
						<query-filters>
							<query-filter name="whereid" and-where-connection="and">
								<value><![CDATA[ id = ? ]]></value>
								<query-params>
									<query-param name="id" type="int" sample="1">
									</query-param>
								</query-params>
							</query-filter>
							<query-filter name="where_entity"
								and-where-connection="and">
								<value><![CDATA[ entity = ? ]]></value>
								<query-params>
									<query-param name="entity" type="string" sample="'region'">
									</query-param>
								</query-params>
							</query-filter>
							<query-filter name="where_id_entity"
								and-where-connection="and">
								<value><![CDATA[ entity_id = ? ]]></value>
								<query-params>
									<query-param name="entity_id" type="int" sample="99">
									</query-param>
								</query-params>
							</query-filter>
							<query-filter name="where_web_path_entity"
								and-where-connection="and">
								<value><![CDATA[ entity_web_path = ? ]]></value>
								<query-params>
									<query-param name="entity_web_path" type="string"
										sample="'xxx'">
									</query-param>
								</query-params>
							</query-filter>
						</query-filters>
					</query>
					<query name="desc_entity_value" id="desc_entity_value"
						package-name="description">
						<query-body>
							<value>
<![CDATA[
select dev.*, ln.flag_icon from description_entity_value dev, i18n_language ln
where dev.i18n_language_code = ln.code
$where_entity $where_id_entity $where_web_path_entity $where_language_code $whereid
]]>
							</value>
						</query-body>
						<query-filters>
							<query-filter name="whereid" and-where-connection="and">
								<value><![CDATA[ id = ? ]]></value>
								<query-params>
									<query-param name="id" type="int" sample="1">
									</query-param>
								</query-params>
							</query-filter>
							<query-filter name="where_entity"
								and-where-connection="and">
								<value><![CDATA[ entity = ? ]]></value>
								<query-params>
									<query-param name="entity" type="string" sample="'region'">
									</query-param>
								</query-params>
							</query-filter>
							<query-filter name="where_id_entity"
								and-where-connection="and">
								<value><![CDATA[ entity_id = ? ]]></value>
								<query-params>
									<query-param name="entity_id" type="int" sample="99">
									</query-param>
								</query-params>
							</query-filter>
							<query-filter name="where_web_path_entity"
								and-where-connection="and">
								<value><![CDATA[ entity_web_path = ? ]]></value>
								<query-params>
									<query-param name="entity_web_path" type="string"
										sample="'xxx'">
									</query-param>
								</query-params>
							</query-filter>
							<query-filter name="where_language_code"
								and-where-connection="and">
								<value><![CDATA[ I18N_LANGUAGE_CODE = ? ]]></value>
								<query-params>
									<query-param name="language_code" type="string"
										sample="'xxx'">
									</query-param>
								</query-params>
							</query-filter>
						</query-filters>
					</query>
					<!-- developer -->
					<query name="tenant_registry" id="tenant_registry"
						   package-name="tenant">
						<query-body>
							<value>
								select t.name, t.web_path, tr.category, tr.url
								from ten_tenant t, ten_tenant_registry tr
								where tr.tenant_id = t.id
								$whereTenantWebPath
							</value>
						</query-body>
						<query-filters>
							<query-filter name="whereTenantWebPath" and-where-connection="and">
								<value><![CDATA[ t.web_path = ? ]]></value>
								<query-params>
									<query-param name="tenant_web_path" type="string" sample="'programme'">
									</query-param>
								</query-params>
							</query-filter>
						</query-filters>
					</query>
				</queries>

			</statement-model>
		</model>

		<targets catalog-entry="REST-Custom"
				 append-catalog-entry-dir-to-outputdir-root="true"
				 outputdir-root="../../product/entity-value-store-api">

			<property name="openxava-disable-sdd" value="true" />
			<property name="environment" value="remote" />
			<property name="show-sql" value="false" />

			<property name="filter-cors" value="apache" />
			<property name="swagger" value="true" />
			<property name="botdetect" value="true" />
			<property name="setter-return-instance" value="true" />
			<property name="add-named-queries" value="false" />

			<property name="target-server" value="tomcat" />
			<property name="embedded-datasource" value="docker">
				<property name="jdbcUrl" value="jdbc:mysql://db:3306/bin_desc_management?connectTimeout=0&amp;socketTimeout=0&amp;autoReconnect=true"/>
				<property name="username" value="root"/>
				<property name="password" value="P@ssw0rd"/>
			</property>
			<!-- -->
			<property name="mail-server" value="mailgun">
				<property name="mail.smtps.host" value="smtp.mailgun.org" />
				<property name="mail.smtps.auth" value="true" />
				<property name="mail.smtp.socketFactory.class" value="javax.net.ssl.SSLSocketFactory" />
				<property name="mail.smtp.starttls.enable" value="true" />
				<property name="mail.smtp.ssl.trust" value="smtp.mailgun.org" />

				<property name="username" value="postmaster@winerylabs.com" />
				<property name="password" value="5155c8411cb29829e715462bbd3cf878" />
				<property name="url" value="smtp.mailgun.com" />
			</property>

			<property name="maven-dependencies">
				<property name="gson"
						  value="group: 'com.google.code.gson', name: 'gson', version: '2.2.4'" />
				<property name="jbcrypt"
						  value="group: 'org.mindrot', name: 'jbcrypt', version: '0.4'" />
				<property name="velocity"
						  value="group: 'org.apache.velocity', name: 'velocity', version: '1.7'" />
				<property name="velocity-tools"
						  value="group: 'org.apache.velocity', name: 'velocity-tools', version: '2.0'" />
				<property name="velocity-tools"
						  value="group: 'org.json', name: 'json', version: '20190722'" />
				<property name="itextpdf"
						  value="group: 'com.itextpdf', name: 'itextpdf', version: '5.5.13'" />
				<property name="itextpdf-xmlworker"
						  value="group: 'com.itextpdf.tool', name: 'xmlworker', version: '5.5.13'" />
				<!-- <property name="javax.mail" value="group: 'javax.mail', name: 'mail',
					version: '1.5.0-b01'"/> -->
			</property>

			<property name="disable-sass-maven-plugin" value="true" />

		</targets>



	</configuration>
</generator-config>